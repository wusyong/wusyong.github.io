<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  
  
  
  

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/galleria@1.6.1/dist/themes/folio/galleria.folio.min.css" integrity="sha384-+rY0QD+LRnTOquDMzGa9lXU6jIwdiQuwCJQ2cdcW0qeP/0UbjQCZlXnRsUMA+9pH" crossorigin="anonymous">
  

  

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.1/css/academicons.min.css" integrity="sha384-FIue+PI4SsI9XfHCz8dBLg33b0c1fMJgNU3X//L26FYbGnlSEfWmNT7zgWc2N9b6" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link href="https://wusyong.github.io/deep-thought.css" rel="stylesheet" />
  
  

  <title>
    
 | After half a year, what now?

  </title>

  
  
  

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" integrity="sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx" crossorigin="anonymous"></script>

  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mathtex-script-type.min.js" integrity="sha384-jiBVvJ8NGGj5n7kJaiWwWp9AjC+Yh8rhZY3GtAX8yU28azcLgoRo4oukO87g7zDT" crossorigin="anonymous"></script>
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
  
  
</head>

<body class="has-background-white">
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item is-size-5 has-text-weight-bold" href="https:&#x2F;&#x2F;wusyong.github.io&#x2F;"></a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;wusyong.github.io&#x2F;&#x2F;">
            Home
          </a>
          
          <a class="navbar-item has-text-weight-semibold" href="https:&#x2F;&#x2F;wusyong.github.io&#x2F;&#x2F;posts">
            Posts
          </a>
          
          
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  
  

  
<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article class="box">
          <h1 class="title">
            After half a year, what now?
          </h1>
          <p class="subtitle"></p>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
<span class="icon-text has-text-grey">
  <span class="icon">
    <i class="fas fa-user"></i>
  </span>
  <span>Wu Yu Wei published on</span>
  <span class="icon">
    <i class="far fa-calendar-alt"></i>
  </span>
  <span><time datetime="2022-09-09T11:04:23+08:00">September 09, 2022</time></span>
</span>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
<span class="icon-text has-text-grey">
  <span class="icon">
    <i class="far fa-clock"></i>
  </span>
  <span>5 min,</span>
  <span class="icon">
    <i class="fas fa-pencil-alt"></i>
  </span>
  <span>959 words</span>
</span>

            </div>
            <div class="column">
              
            </div>
            <div class="column has-text-right-desktop">
              
            </div>
          </div>
          <div class="content mt-2">
            <p>At the beginning of this year, I was planning to contribute to Servo and wish to restore its glory. But after diving into the code base and understanding its landscape, I accepted the cruel reality that it's impossible unless Servo can be adequately funded again, just as previous Servo members advised. So I will not continue the series of Servo posts. However, I hope I can demonstrate the situation it faces well in this post, grasp the remaining we have, and look for where we can explore further.</p>
<h2 id="what-happened-after-mozilla-layoff">What happened after Mozilla layoff?</h2>
<p>After <a href="https://www.theverge.com/2020/8/11/21363424/mozilla-layoffs-quarter-staff-250-people-new-revenue-focus">Mozilla layoff</a> in 2020, most members from Servo are fired AFAIK. Despite being moved under <a href="https://blog.servo.org/2020/11/17/servo-home/">Linux Foundation</a>, the foundation would only cover its cost of CI/CD. So technically speaking, the project was already in maintenance mode at that time. But several parts in Servo are already integrated into Firefox, and some people in Mozilla still maintain them to date. I was hoping if we can fill the missing puzzle in Servo, we can get a minimum viable browser or a webview library. However, it didn't go as easy as I thought would be. There are some blockers just too difficult for normal contributors to refactor.</p>
<h3 id="unable-to-upgrade-spoodermonke">Unable to upgrade SpooderMonke</h3>
<p>Servo, as a project under Mozilla, uses SpiderMonkey as its JavaScript engine. <a href="https://github.com/servo/rust-mozjs">Mozjs</a> and rust-mozjs are its wrappers on top of SpiderMonkey. In the last two years, contributors are trying to upgrade it to the latest version but they <a href="https://github.com/servo/mozjs/pull/284">all</a> <a href="https://github.com/servo/mozjs/pull/295">failed</a>. Servo still uses version 88 nowadays, while SpiderMonkey has already published 108 at the time of this post. And the engine itself is also the problem IMHO. Its types, GC, and design affect not only the script layer, but also the rest of Servo. Although Rust doesn't require any garbage collection, JavaScript in script layer needs it. In order to use the GC from SpiderMonky, Servo has to create <a href="https://manishearth.github.io/blog/2021/04/05/a-tour-of-safe-tracing-gc-designs-in-rust/#servos-dom-integration">crazy amount of types and lints</a> to control it. This makes handling DOM types extremely verbose, and hence also affects whole style crate and layout crate since they all have to deal with these types. I once considered perhaps we could switch to v8 instead which have a well-maintained crate from deno. But after giving a try of its API for dealing with GC and creating JavaScript types, I got a conclusion that it will fall into same scenario like Mozjs already has. Unless Rust has a decent crate for GC, I don't believe we can work with a GC language seamlessly. <a href="https://github.com/withoutboats/shifgrethor">Shifgrethor</a> is the closest we could get, and I also forked it into <a href="https://github.com/wusyong/elise">elise</a> for testing multi-thread situations. But it relys on several nightly features.</p>
<h3 id="spaghetti-inside-script-style-layout">Spaghetti inside script/style/layout</h3>
<p>One of the main goals of Servo is to extract each feature from a browser into individual crates. This has been succeed in some features like HTML parsing, selecting CSS, and rendering etc. But there are some crates still tangle around and unable to do so which are <code>script</code>, <code>style</code>, and <code>layout</code> crates. We already see types from GC affect all these crates. It's also difficult to distinguish which document traversals should belong to whom. The worst part is the old layout is sort of incorrect. Back in the day, they want to make the layout to be parallel as possible. But this didn't work well in some attributes like flex and absolute. When they tried to rewrite a new one, the layoff happened. So now we have two layout crates: <a href="https://github.com/servo/servo/tree/master/components/layout">the old one</a> is more complete but would be wrong in specific properties; <a href="https://github.com/servo/servo/tree/master/components/layout_2020">the new one</a> has almost nothing but should be correct if only it could be complete. If you try to fix some layout issues, you will have to jump around different crates again and again. And the amount of issue is massive already!</p>
<h2 id="crates-that-still-work-well">Crates that still work well</h2>
<p>With huge blockers like those mentioned above, I tend to agree it will require proper funding to be able to start developing again. In the near future, I feel like we should focus on those crates which are already mature and explore further on top of them. Take crates like <code>html5ever</code>, <code>cssparser</code> for example, they become the bedrock of every modern web framework. There are also crates like kuchiki and scraper which build on top to make users easier to use. And I hope perhaps same thing can happen to webrender.</p>
<p><a href="https://github.com/servo/webrender">Webrender</a> is one of a few crates still maintained by Mozilla and is being used by Firefox directly! There was a GUI crate called <a href="https://github.com/fschutt/azul">Azul</a> that once used Webrender to build the layout system. Although Azul is also no longer maintained due to <a href="https://www.reddit.com/r/rust/comments/c24b57/azul_the_gui_framework_will_be_unmaintained_from/">personal reasons</a>, I feel like we could give it another shot and see if an HTML/CSS layout system can work again. I understand it will be very limited without any scripting functionality. But I hope we can try something other than DOM layer built by JavaScript engine. Maybe an API for document tree could work, or just doing regular XML parsing as other GUI frameworks do is enough. I don't have any conclusion yet, but I haven't come this far just to end the journey here either!</p>

          </div>
        </article>
      </div>
      
    </div>
  </div>
</section>


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Search</p>
      </header>
      <section class="modal-card-body">
        <div class="field mb-2">
          <div class="control">
            <input class="input" id="search" placeholder="Search this website." type="search" />
          </div>
        </div>
        <div class="search-results">
          <div class="search-results__items"></div>
        </div>
      </section>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


  

<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-8">
        <nav class="level">
              
          <div class="level-item has-text-centered">
            <a class="button is-black is-outlined" href="https:&#x2F;&#x2F;wusyong.github.io&#x2F;posts&#x2F;rust-kernel-module-03&#x2F;">
              <span class="icon mr-2">
                <i class="fas fa-arrow-circle-left"></i>
              </span>
              Rust Kernel Module: Pinning
            </a>
          </div>
           
          <div class="level-item has-text-centered">
            <a class="button is-black is-outlined" href="https:&#x2F;&#x2F;wusyong.github.io&#x2F;posts&#x2F;gat&#x2F;">
              GAT 懶人包<span class="icon ml-2">
                <i class="fas fa-arrow-circle-right"></i>
              </span>
            </a>
          </div>
          
        </nav>
      </div>
    </div>
  </div>
</section>



  



  
  <footer class="footer py-4">
    <div class="content has-text-centered">
      <p>
        Built with
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-code"></i>
          </span>
          <span>code</span>
        </span>
        and
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-heart"></i>
          </span>
          <span>love</span>
        </span>
      </p>
      <p>
        Powered by
        <span class="icon-text">
          <span class="icon">
            <i class="fas fa-power-off"></i>
          </span>
          <span>zola</span>
        </span>
      </p>
    </div>
  </footer>
  

  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/galleria@1.6.1/dist/galleria.min.js" integrity="sha384-QSfwGT8/EU536DKdtyP2D6SLlh8zBaZ0cVkwfrwhqzIU9VCfJT00CLVP5t+HAiYg" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/galleria@1.6.1/dist/themes/folio/galleria.folio.min.js" integrity="sha384-DwpKI+deZB267+hPKwiOIc5Y2GKsVL0mR6hgz7GgIu7AgAMYqJwcJKY1YBNfhWcY" crossorigin="anonymous"></script>
  
  
  <script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.5/dist/mermaid.min.js" integrity="sha384-0yWn54pSGtfKCU+skfA69l25VsCw+MZt4LQov3xNRoS7YkAMrFokGgSBnAWSK4pv" crossorigin="anonymous"></script>
  
  
  <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1.1.13/dist/chart.xkcd.min.js" integrity="sha384-xC3h1+IHXK8seA+8KfT79Z4e0GPsznjXBoMa5nd8ooWKplPyXx92NOmljWxLC/cs" crossorigin="anonymous"></script>
  
  
  <script src="https://wusyong.github.io/elasticlunr.min.js"></script>
  <script src="https://wusyong.github.io/search_index.en.js"></script><script src="https://wusyong.github.io/js/site.js"></script>

  





  
  
</body>

</html>
